# Claude Code Hook Templates

Hook templates for the Claude Code platform. Hooks are bash scripts triggered by Claude Code events. They encode methodology as invisible infrastructure -- behaviors that happen automatically without the agent needing to remember.

## Hook Events

Claude Code supports three hook events relevant to generated vaults:

### SessionStart -- Orientation

**What it does:** Injects workspace context at the start of every session so the agent always knows what files exist, what it was working on, and where to pick up.

**Template behavior:**

1. **Tree injection** -- Run `find` or `tree` to show the workspace structure up to 3 levels deep. This gives the agent a map of all files without reading any of them.

2. **self/ loading** -- If the system has a self/ directory (personal memory), load `self/README.md` or the memory orientation file so the agent remembers who it is.

3. **Goal checking** -- If a goals file exists, surface current priorities so the agent can orient to what matters.

4. **Queue summary** -- If a queue file exists, show pipeline and maintenance task counts so the agent knows what needs attention. Full condition reconciliation happens in /next, not the hook.

**Generated as:**
```
.claude/hooks/hooks.json    (event configuration)
.claude/hooks/scripts/session-orient.sh
```

### PostToolUse (Write) -- Validation

**What it does:** Triggers after the agent writes to a notes directory. Catches schema violations and discovery opportunities at the moment of creation rather than during periodic review.

**Template behavior:**

1. **Schema validation** -- Check that the written file has required YAML frontmatter fields (description, topics at minimum). Warn but do not block -- capture speed matters more than perfection.

2. **Discovery check** -- Optionally remind the agent to check for connections after creating a new note. This is a nudge, not enforcement -- the processing pipeline handles connection finding systematically.

**Generated as:**
```
.claude/hooks/hooks.json    (event configuration, filtered to Write tool + notes path)
.claude/hooks/scripts/validate-note.sh
```

### Stop -- Persistence

**What it does:** Triggers when the session ends. Ensures work is persisted and handoff state is captured.

**Template behavior:**

1. **Session persist** -- If a session log template is active, append a session summary to the log. This creates continuity between sessions.

2. **Git commit** -- If the vault is in a git repository, stage and commit changes with an auto-generated message. This ensures nothing is lost between sessions.

**Generated as:**
```
.claude/hooks/hooks.json    (event configuration)
.claude/hooks/scripts/session-persist.sh
```

## Generation Notes

The derivation engine generates hook scripts based on enabled features:

| Feature Block | Hook Impact |
|---------------|-------------|
| `session-rhythm.md` | Enables SessionStart and Stop hooks |
| `schema.md` | Enables PostToolUse validation hook |
| `semantic-search.md` | Adds index freshness check to SessionStart |
| `processing-pipeline.md` | Adds queue status to SessionStart |
| `self-evolution.md` | Adds queue summary to SessionStart |

Hooks are generated once during /setup and can be modified by /architect or /reseed as the system evolves.

## Hook Configuration Format

Hooks can be configured in two places:

- **Plugin hooks** (`hooks/hooks.json` in the plugin root) — applied when the plugin is enabled
- **Project hooks** (`.claude/settings.json` in the generated vault) — project-level, can be committed

Both use the same nested matcher-group format. Each event type contains an array of matcher groups. Each matcher group has an optional `matcher` (regex string) and a `hooks` array of handler objects.

**Plugin hooks** (`hooks/hooks.json`):

```json
{
  "description": "Ars Contexta plugin hooks",
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/scripts/session-orient.sh",
            "timeout": 10
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/scripts/validate-note.sh",
            "timeout": 5
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/hooks/scripts/session-persist.sh",
            "timeout": 15
          }
        ]
      }
    ]
  }
}
```

**Project hooks** (`.claude/settings.json`, generated by /setup):

```json
{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/session-orient.sh"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/validate-note.sh"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "bash .claude/hooks/session-capture.sh"
          }
        ]
      }
    ]
  }
}
```

### Matcher Reference

| Event | What matcher filters | Example |
|-------|---------------------|---------|
| `SessionStart` | How session started | `"startup"`, `"resume"`, `"clear"` |
| `PreToolUse`, `PostToolUse` | Tool name | `"Write"`, `"Edit\|Write"`, `"Bash"` |
| `SubagentStart`, `SubagentStop` | Agent type | `"Explore"`, `"knowledge-worker"` |
| `Stop`, `UserPromptSubmit` | No matcher support | Always fires |

Events without matcher support: omit the `matcher` field entirely.

### Handler Fields

| Field | Required | Description |
|-------|----------|-------------|
| `type` | yes | `"command"`, `"prompt"`, or `"agent"` |
| `command` | yes (command type) | Shell command to execute |
| `timeout` | no | Seconds before canceling (default: 600) |
| `async` | no | If `true`, runs in background without blocking |
