<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ars Contexta | Library Intake</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <header class="hero">
    <div class="hero-copy">
      <p class="eyebrow">Ars Contexta</p>
      <h1>Build Your Business Context Libraries</h1>
      <p>Answer plain-language prompts and generate a versioned manifest for baseline library creation.</p>
    </div>
    <div class="hero-actions">
      <button id="btnApplyBankStarter">Use Bank Starter</button>
      <button id="btnExportManifest" class="primary">Download manifest.json</button>
      <button id="btnSaveRevision">Save Revision</button>
    </div>
  </header>

  <main class="shell">
    <section class="progress-wrap">
      <div class="progress-head">
        <h2 id="stepTitle">Step</h2>
        <p id="stepHint"></p>
      </div>
      <div class="progress-track"><div id="progressBar"></div></div>
      <ol id="stepper" class="stepper"></ol>
    </section>

    <section class="help-panel">
      <h3>Help and Examples</h3>
      <p id="helpIntro" class="explain"></p>
      <div class="help-grid">
        <div class="help-block">
          <strong>What to enter</strong>
          <ul id="helpExpected"></ul>
        </div>
        <div class="help-block">
          <strong>Good defaults</strong>
          <ul id="helpDefault"></ul>
        </div>
        <div class="help-block">
          <strong>Sample answers</strong>
          <ul id="helpSample"></ul>
        </div>
        <div class="help-block warn">
          <strong>Common mistakes</strong>
          <ul id="helpPitfalls"></ul>
        </div>
      </div>
    </section>

    <section class="panel" id="panelProgram">
      <h3>Program Basics</h3>
      <p class="explain">Define the owner, identity, and business outcome for this graph.</p>
      <div class="grid-2">
        <label>Program name<input id="programName" type="text" placeholder="Bank Business Function Meta-Graph"></label>
        <label>Program ID<input id="programId" type="text" placeholder="bank-context-graph"></label>
        <label>Owner team or unit<input id="ownerUnit" type="text" placeholder="Operations Excellence"></label>
        <label>Main outcome<input id="targetOutcome" type="text" placeholder="Reduce cross-functional process failures"></label>
      </div>
    </section>

    <section class="panel" id="panelInterview">
      <h3>Guided Interview (Optional)</h3>
      <p class="explain">If this is easier for stakeholders, answer prompts and auto-fill the form.</p>
      <div class="prompt-box"><p id="interviewPrompt"></p></div>
      <label>Your answer
        <textarea id="interviewAnswer" rows="4" placeholder="Type your answer in plain language..."></textarea>
      </label>
      <div class="row">
        <button id="btnInterviewApply" class="primary">Apply This Answer</button>
        <button id="btnInterviewNext">Next Prompt</button>
      </div>
    </section>

    <section class="panel" id="panelLibraries">
      <h3>Libraries (Business Functions)</h3>
      <p class="explain">One card per function, such as Payments Ops or Fraud Ops.</p>
      <div class="row tools">
        <button id="btnAddLibrary">Add Library</button>
        <button id="btnRefreshTemplates">Refresh Templates</button>
      </div>
      <div class="template-box">
        <label>Bank template
          <select id="templateSelect"></select>
        </label>
        <div class="row tools">
          <button id="btnTemplateLoadMerge">Merge Template</button>
          <button id="btnTemplateLoadReplace">Load Template (Replace)</button>
        </div>
        <p id="templateInfo" class="micro"></p>
      </div>
      <div class="row tools">
        <button id="btnRefreshApprovedCatalogs">Refresh Approved Sets</button>
      </div>
      <label>Approved library set
        <select id="approvedProgramSelect"></select>
      </label>
      <div class="row tools">
        <button id="btnLoadApprovedLibraries">Load Selected Approved Libraries</button>
        <button id="btnLoadApprovedWithLinks">Load Selected Approved + Handoffs</button>
      </div>
      <p id="approvedInfo" class="micro"></p>
      <div id="librariesContainer"></div>
    </section>

    <section class="panel" id="panelTerms">
      <h3>Shared Business Terms</h3>
      <p class="explain">Use the same words across teams for consistent linking.</p>
      <div class="chips" id="entityChips"></div>
      <label>Shared entities (comma-separated)
        <input id="sharedEntities" type="text" placeholder="process, control, risk, metric, exception">
      </label>
      <div class="chips" id="relationshipChips"></div>
      <label>Shared relationship types (comma-separated)
        <input id="sharedRelationships" type="text" placeholder="depends_on, owned_by, mitigates, measured_by">
      </label>
    </section>

    <section class="panel" id="panelHandoffs">
      <h3>Handoffs Between Teams</h3>
      <p class="explain">Capture where work, controls, or escalations cross boundaries.</p>
      <div class="row tools">
        <button id="btnAddLink">Add Handoff</button>
        <button id="btnAddLinkFromApproved">Insert Handoff from Approved Libraries</button>
      </div>
      <div id="linksContainer"></div>
    </section>

    <section class="panel" id="panelArtifact">
      <h3>AI Draft from Documents (Optional)</h3>
      <p class="explain">Paste SOPs, runbooks, or incident summaries. Apply only suggestions you trust.</p>
      <label>Artifact text
        <textarea id="artifactText" rows="8" placeholder="Paste source text here..."></textarea>
      </label>
      <label class="file-input">Upload text file
        <input type="file" id="artifactFileInput" accept=".txt,.md,.csv,.log">
      </label>
      <button id="btnSuggestFromArtifact" class="primary">Generate AI Suggestions</button>
      <div id="artifactSuggestions"></div>
    </section>

    <section class="panel" id="panelMap">
      <h3>Visual Library Map</h3>
      <p class="explain">Drag cards so cross-functional flows are easy to read.</p>
      <div class="map-wrap">
        <svg id="mapSvg"></svg>
        <div id="mapBoard"></div>
      </div>
    </section>

    <section class="panel" id="panelGovernance">
      <h3>Governance & Controls</h3>
      <p class="explain">Set baseline compliance, cadence, and provenance requirements.</p>
      <div class="grid-2">
        <label>Data classification baseline
          <select id="classificationBaseline">
            <option>public</option>
            <option>internal</option>
            <option selected>confidential</option>
            <option>restricted</option>
          </select>
        </label>
        <label>Review cadence
          <select id="reviewCadence">
            <option>weekly</option>
            <option selected>monthly</option>
            <option>quarterly</option>
          </select>
        </label>
        <label>Retention (months)<input id="retentionMonths" type="number" value="36"></label>
        <label>Change approval
          <select id="changeApproval">
            <option>none</option>
            <option>single-approver</option>
            <option selected>dual-approver</option>
            <option>CAB</option>
          </select>
        </label>
        <label class="full">Required provenance fields
          <input id="provenanceFields" type="text" value="source_ref,captured_at,owner_role,confidence,effective_from">
        </label>
      </div>
    </section>

    <section class="panel" id="panelReview">
      <h3>Review, Versioning, and Export</h3>
      <p class="explain">Save revisions, approve a revision, then export JSON for generation.</p>
      <div class="row tools">
        <button id="btnExportAnswers">Download answers.json</button>
        <button id="btnExportManifest2" class="primary">Download manifest.json</button>
        <label class="file-input">Import JSON
          <input type="file" id="importJsonInput" accept=".json">
        </label>
      </div>
      <div class="row tools">
        <button id="btnLoadRevisions">Refresh Revisions</button>
        <select id="revisionSelect"></select>
        <button id="btnLoadRevision">Load Selected Revision</button>
      </div>
      <div class="row tools">
        <input id="approvedBy" type="text" placeholder="Approved by (role or name)">
        <button id="btnApproveCurrent">Mark Revision as Approved</button>
      </div>
      <pre id="manifestPreview"></pre>
    </section>

    <footer class="wizard-nav">
      <button id="btnPrevStep">Back</button>
      <span id="status"></span>
      <button id="btnNextStep" class="primary">Next</button>
    </footer>
  </main>

  <script src="./app.js"></script>

  <div id="approvedLinkModal" class="modal hidden" aria-hidden="true">
    <div id="approvedModalBackdrop" class="modal-backdrop"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="approvedModalTitle">
      <h3 id="approvedModalTitle">Insert Handoff from Approved Libraries</h3>
      <p class="explain">Pick an approved context set, then choose source and target libraries. If a selected library is not in your current draft, it will be added automatically.</p>
      <label>Approved context set
        <select id="approvedCatalogSelect"></select>
      </label>
      <div class="grid-2">
        <label>From library
          <select id="approvedSourceSelect"></select>
        </label>
        <label>To library
          <select id="approvedTargetSelect"></select>
        </label>
      </div>
      <div class="grid-2">
        <label>Handoff type
          <select id="approvedContractType">
            <option>handoff</option>
            <option>control</option>
            <option>data</option>
            <option>escalation</option>
            <option>dependency</option>
          </select>
        </label>
        <label>What moves?
          <input id="approvedObject" type="text" placeholder="high-risk-payment-exception">
        </label>
      </div>
      <label>Trigger event
        <input id="approvedTriggerEvent" type="text" placeholder="exception.severity == critical">
      </label>
      <div class="grid-2">
        <label>SLA target
          <input id="approvedSlaTarget" type="text" placeholder="15m">
        </label>
        <label>Failure signal
          <input id="approvedFailureSignal" type="text" placeholder="no_ack_within_sla">
        </label>
      </div>
      <label>Required fields (comma-separated)
        <input id="approvedRequiredFields" type="text" placeholder="exception_id,severity,owner_role">
      </label>
      <p id="approvedModalInfo" class="micro"></p>
      <div class="row tools">
        <button id="btnApprovedInsert" class="primary">Insert Handoff</button>
        <button id="btnApprovedCancel">Cancel</button>
      </div>
    </div>
  </div>
</body>
</html>
